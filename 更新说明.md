# 系统更新说明

## 🎉 新增功能

### 1. 仪表板增强
- **可点击的统计卡片**：
  - 点击"监控规则总数"跳转到监控规则管理页面
  - 点击"新增招聘"、"更新招聘"、"下架招聘"跳转到扫描结果页面
  - 所有卡片添加了hover效果，鼠标悬停时有视觉反馈

### 2. 平台数据监控（新页面）
- **位置**：左侧菜单 → "平台数据监控"
- **功能**：
  - 实时查看模拟招聘平台的统计数据
  - 显示招聘总数、活跃招聘、已下架、平均薪资
  - 展示城市分布和公司列表
  - 查看最近更新的招聘信息（区分新增和修改）
  - 支持手动刷新和获取最近更新

### 3. 第三方数据接入API（重构）
- **简化说明**：只展示推送数据相关的API
- **包含接口**：
  - 获取访问令牌（认证）
  - 推送单个职位
  - 批量推送职位（最多100条）
  - 更新职位信息
  - 下架职位
- **完整示例**：提供Python和JavaScript的完整调用代码

### 4. 后端推送API（新增）
- **基础路径**：`/api/v1/jobs/push`
- **接口列表**：
  ```
  POST   /api/v1/jobs/push           - 推送单个职位
  POST   /api/v1/jobs/push/batch     - 批量推送
  PUT    /api/v1/jobs/push/<job_id>  - 更新职位
  DELETE /api/v1/jobs/push/<job_id>  - 下架职位
  ```
- **特性**：
  - 需要JWT Token认证
  - 自动检测职位是否存在（存在则更新，不存在则创建）
  - 批量推送支持部分失败（返回详细错误信息）
  - 自动更新时间戳

## 🚀 如何使用

### 方法一：Windows批处理文件（推荐）

1. **重新构建所有服务**：
   ```bash
   双击运行 rebuild_all.bat
   ```

2. **检查监控系统是否正常工作**：
   ```bash
   双击运行 check_monitoring.bat
   ```

### 方法二：手动命令

如果你在WSL或Linux环境中：

1. **重新构建**：
   ```bash
   chmod +x rebuild_all.sh
   ./rebuild_all.sh
   ```

2. **检查监控**：
   ```bash
   chmod +x check_monitoring.sh
   ./check_monitoring.sh
   ```

3. **如果在原生Linux/WSL中使用docker-compose**：
   ```bash
   docker-compose down
   docker-compose up -d --build
   ```

## 📊 使用指南

### 查看平台数据变化

1. 登录系统后，点击左侧菜单的"平台数据监控"
2. 查看模拟平台的实时统计数据
3. 点击"刷新数据"获取最新统计
4. 点击"获取最近更新"查看最近变化的招聘信息

### 调用推送API

1. 访问"第三方数据接入"页面获取API文档
2. 使用你的账号登录获取access_token
3. 参考页面中的Python或JavaScript示例代码
4. 推送你的招聘数据到系统

示例（Python）：
```python
import requests

# 1. 获取Token
response = requests.post(
    "http://localhost:5000/api/v1/auth/login",
    json={"username": "your_username", "password": "your_password"}
)
token = response.json()["data"]["access_token"]

# 2. 推送职位
job_data = {
    "job_id": "unique_id_123",
    "company": "示例公司",
    "position": "Python开发",
    "skills": ["Python", "Django"],
    "location": "北京",
    "salary_min": 25,
    "salary_max": 35,
    "status": "active"
}

response = requests.post(
    "http://localhost:5000/api/v1/jobs/push",
    headers={"Authorization": f"Bearer {token}"},
    json=job_data
)
print(response.json())
```

### 检查监控是否工作

如果你设置了监控规则但没有收到新招聘通知：

1. 运行 `check_monitoring.bat` 检查系统状态
2. 查看输出，确认：
   - Celery Beat 是否在定时执行任务
   - Celery Worker 是否在处理任务
   - 模拟平台是否有新数据
   - 扫描结果是否有记录

3. 如果没有新数据，可能原因：
   - 模拟平台数据没有变化（可以访问 http://localhost:5001/api/v1/stats 查看）
   - 监控规则的筛选条件太严格，没有匹配到新职位
   - Celery Beat 调度间隔还未到（默认1小时）

4. 手动触发一次监控：
   ```bash
   # 进入监控规则页面，点击某个规则的"测试"按钮
   # 或者运行 check_monitoring.bat，它会自动触发所有活跃规则
   ```

## 🔧 故障排查

### 问题1：前端页面显示空白或404

**解决**：
```bash
rebuild_all.bat
```
等待服务完全启动后访问 http://localhost:8080

### 问题2：推送API返回401错误

**解决**：
- 检查Token是否过期（有效期24小时）
- 重新登录获取新Token
- 确认请求头格式：`Authorization: Bearer {token}`

### 问题3：监控没有发现新职位

**解决**：
1. 访问"平台数据监控"页面，查看平台是否有数据变化
2. 检查监控规则的筛选条件（关键词、城市、薪资范围）
3. 查看"扫描结果"页面，确认是否有扫描记录
4. 运行 `check_monitoring.bat` 进行全面诊断

### 问题4：邮件通知未收到

**解决**：
1. 检查 `.env` 文件中的邮件配置是否正确
2. 查看后端日志：`docker-compose logs backend`
3. 确认邮箱授权码（不是登录密码）
4. 检查垃圾邮件箱

## 📝 文件说明

- `rebuild_all.bat` / `rebuild_all.sh` - 重新构建所有Docker服务
- `check_monitoring.bat` / `check_monitoring.sh` - 监控系统诊断工具
- `frontend/src/views/PlatformMonitor.vue` - 平台数据监控页面
- `frontend/src/views/ApiDocs.vue` - 第三方数据接入文档（已简化）
- `backend/app/routes/push.py` - 推送API实现

## 🎯 下一步

1. 运行 `rebuild_all.bat` 应用所有更新
2. 访问 http://localhost:8080 登录系统
3. 探索新的"平台数据监控"页面
4. 查看简化后的"第三方数据接入"文档
5. 如有问题，运行 `check_monitoring.bat` 进行诊断

---

**更新时间**: 2025-10-28
**版本**: v1.1.0

