# 招聘信息监控系统 - 使用指南

## 一、系统介绍

这是一个基于爬虫的招聘信息监控系统，可以帮助你自动监控招聘平台的岗位变化，并通过邮件及时通知。

### 主要功能

1. **用户管理**：注册、登录、个人信息管理
2. **监控规则**：创建和管理监控规则，支持关键词、城市、薪资过滤
3. **自动监控**：定时扫描招聘信息，检测新增、更新和下架
4. **邮件通知**：根据规则自动发送邮件通知
5. **结果查看**：查看历史扫描结果和变化详情
6. **招聘搜索**：搜索和浏览所有招聘信息

## 二、快速开始

### 方式一：使用Docker（推荐）

**前置要求**：
- Docker 20.10+
- Docker Compose 2.0+

**启动步骤**：

```bash
# 1. 克隆或下载项目
cd end_system

# 2. (可选) 配置邮件
# 编辑 .env 文件，填入你的邮箱配置
# MAIL_USERNAME=your-email@gmail.com
# MAIL_PASSWORD=your-app-password

# 3. 启动所有服务
chmod +x start.sh
./start.sh

# 或者直接使用 docker-compose
docker-compose up -d
```

**访问系统**：
- 前端界面：http://localhost:5173
- 后端API：http://localhost:5000
- API文档：http://localhost:5000/apidocs

### 方式二：本地开发

#### 1. 启动数据库和Redis

```bash
docker-compose up -d postgres redis
```

#### 2. 启动模拟招聘平台

```bash
cd mock_platform
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
pip install -r requirements.txt
flask run --port=5001
```

#### 3. 启动后端

```bash
cd backend
python -m venv venv
source venv/bin/activate
pip install -r requirements.txt

# 配置环境变量
cp .env.example .env
# 编辑 .env 文件

# 数据库迁移
export FLASK_APP=app.main
flask db upgrade

# 启动后端
flask run --port=5000

# 启动Celery Worker（新终端）
celery -A app.celery_app worker -l info

# 启动Celery Beat（新终端）
celery -A app.celery_app beat -l info
```

#### 4. 启动前端

```bash
cd frontend
npm install
npm run dev
```

## 三、使用流程

### 1. 注册账号

访问 http://localhost:5173，点击"立即注册"：
- 输入用户名（3-20个字符）
- 输入有效的邮箱地址
- 设置密码（至少6个字符）

### 2. 登录系统

使用注册的用户名和密码登录系统。

### 3. 创建监控规则

进入"监控规则"页面，点击"创建规则"：

**基本配置**：
- **规则名称**：给规则起一个容易识别的名字，如"Python后端岗位"
- **监控关键词**：输入你关心的关键词，如 `Python`、`后端`、`Django`
- **排除关键词**：（可选）排除不感兴趣的内容，如 `实习`

**过滤条件**：
- **城市过滤**：选择目标城市，如北京、上海、深圳
- **薪资范围**：设置期望的薪资区间（单位：K/月）

**通知设置**：
- **立即通知**：有任何变化立即发邮件
- **每小时汇总**：每小时汇总一次发送
- **每天汇总**：每天汇总一次发送
- **达到数量时**：积累到指定数量后发送

**启用状态**：
- 开启后规则会自动执行
- 关闭后暂停监控

### 4. 测试规则

创建规则后，可以点击"测试"按钮立即执行一次监控，验证规则是否正确。

### 5. 查看结果

进入"扫描结果"页面，可以看到：
- 扫描时间
- 新增、更新、下架的招聘数量
- 邮件发送状态

点击"查看详情"可以查看具体的招聘信息变化。

### 6. 搜索招聘

进入"招聘搜索"页面，可以：
- 按关键词搜索
- 按城市过滤
- 按薪资范围筛选
- 查看招聘详情

## 四、邮件配置

### Gmail配置（推荐）

1. **开启两步验证**
   - 登录 Gmail
   - 进入"管理你的 Google 账号" > "安全性"
   - 开启"两步验证"

2. **生成应用专用密码**
   - 在"安全性"页面
   - 找到"应用专用密码"
   - 选择"邮件"和设备
   - 生成密码

3. **配置环境变量**

编辑 `.env` 文件：

```env
MAIL_SERVER=smtp.gmail.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-email@gmail.com
MAIL_PASSWORD=生成的应用专用密码
MAIL_DEFAULT_SENDER=your-email@gmail.com
```

### 其他邮箱配置

**QQ邮箱**：
```env
MAIL_SERVER=smtp.qq.com
MAIL_PORT=587
MAIL_USE_TLS=True
MAIL_USERNAME=your-qq@qq.com
MAIL_PASSWORD=授权码
```

**163邮箱**：
```env
MAIL_SERVER=smtp.163.com
MAIL_PORT=465
MAIL_USE_SSL=True
MAIL_USERNAME=your-email@163.com
MAIL_PASSWORD=授权码
```

## 五、高级功能

### 自定义监控频率

默认情况下，系统每30分钟执行一次所有监控规则。

修改监控频率：编辑 `backend/app/celery_app.py`

```python
celery.conf.beat_schedule = {
    'execute-all-monitoring-tasks': {
        'task': 'app.tasks.monitor.execute_all_monitoring_tasks',
        'schedule': crontab(minute='*/15'),  # 改为15分钟
    },
}
```

### 数据库管理

```bash
# 进入后端容器
docker-compose exec backend bash

# 创建新的迁移
flask db migrate -m "描述"

# 执行迁移
flask db upgrade

# 回滚迁移
flask db downgrade
```

### 查看日志

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f backend
docker-compose logs -f celery_worker
docker-compose logs -f celery_beat
```

## 六、常见问题

### 1. 邮件发送失败

**问题**：测试规则后没有收到邮件

**解决方案**：
- 检查邮箱配置是否正确
- 确认使用的是应用专用密码，而非登录密码
- 查看 celery_worker 日志：`docker-compose logs celery_worker`

### 2. 监控不执行

**问题**：规则已启用但没有生成扫描结果

**解决方案**：
- 确认 celery_beat 服务正在运行：`docker-compose ps`
- 查看 celery_beat 日志：`docker-compose logs celery_beat`
- 手动测试规则确认是否可以执行

### 3. 前端无法连接后端

**问题**：前端显示"网络错误"

**解决方案**：
- 确认后端服务正在运行：`docker-compose ps backend`
- 检查后端健康状态：访问 http://localhost:5000/health
- 查看后端日志：`docker-compose logs backend`

### 4. 数据库连接失败

**问题**：后端启动失败，提示数据库连接错误

**解决方案**：
- 确认 PostgreSQL 服务正在运行
- 等待数据库完全启动（首次启动需要初始化）
- 重启后端服务：`docker-compose restart backend`

## 七、系统架构

```
┌─────────────┐
│   前端      │  Vue 3 + Ant Design Vue
│  (5173)     │
└──────┬──────┘
       │
       │ HTTP
       │
┌──────▼──────┐
│   后端API   │  Flask + SQLAlchemy
│  (5000)     │
└──────┬──────┘
       │
       ├──────────┐
       │          │
┌──────▼──────┐  │
│  PostgreSQL │  │
│  (5432)     │  │
└─────────────┘  │
                 │
       ┌─────────▼────────┐
       │  Redis (6379)    │
       └─────────┬────────┘
                 │
       ┌─────────┴─────────┐
       │                   │
┌──────▼──────┐   ┌────────▼────────┐
│Celery Worker│   │  Celery Beat    │
│  (监控执行)  │   │  (定时调度)     │
└─────────────┘   └─────────────────┘
       │
       │ HTTP
       │
┌──────▼──────┐
│ 模拟招聘平台 │
│  (5001)     │
└─────────────┘
```

## 八、开发指南

### API接口文档

访问 http://localhost:5000/apidocs 查看完整的 API 文档。

### 目录结构

```
end_system/
├── backend/           # 后端服务
│   ├── app/          # 应用核心
│   │   ├── models.py # 数据模型
│   │   ├── routes/   # API路由
│   │   └── tasks/    # Celery任务
│   ├── config.py     # 配置文件
│   └── migrations/   # 数据库迁移
├── frontend/         # 前端应用
│   └── src/
│       ├── views/    # 页面组件
│       ├── stores/   # 状态管理
│       └── api/      # API客户端
├── mock_platform/    # 模拟招聘平台
└── docker-compose.yml
```

## 九、技术栈

### 后端
- Flask 3.0 - Web框架
- SQLAlchemy - ORM
- PostgreSQL 15 - 数据库
- Redis 7 - 缓存和消息队列
- Celery - 异步任务队列
- Flask-JWT-Extended - JWT认证

### 前端
- Vue 3 - 前端框架
- TypeScript - 类型系统
- Ant Design Vue 4 - UI组件库
- Pinia - 状态管理
- Axios - HTTP客户端

### 基础设施
- Docker - 容器化
- Docker Compose - 服务编排

## 十、联系支持

如有问题或建议，欢迎通过以下方式联系：
- GitHub Issues
- 邮箱：support@example.com

---

祝使用愉快！

